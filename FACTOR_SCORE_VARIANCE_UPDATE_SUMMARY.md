# ìš”ì¸ì ìˆ˜ ë¶„ì‚° ì²´í¬ ê¸°ëŠ¥ ì¶”ê°€ ì™„ë£Œ âœ…

## ğŸ“‹ ìš”ì•½

ìˆœì°¨ì¶”ì • ëª¨ë¸ 1ë‹¨ê³„ì—ì„œ ê³„ì‚°ëœ **ìš”ì¸ì ìˆ˜ì˜ ë¶„ì‚°(variance)**ì´ ë„ˆë¬´ ì‘ìœ¼ë©´ 2ë‹¨ê³„ ì„ íƒëª¨ë¸ì—ì„œ ë¹„ìœ ì˜í•˜ê²Œ ë‚˜ì˜¬ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤. ì´ë¥¼ ì‚¬ì „ì— ì§„ë‹¨í•˜ê¸° ìœ„í•´ ìš”ì¸ì ìˆ˜ ë¶„ì‚° ê³„ì‚° ë° íŒë‹¨ ë¡œì§ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.

## âœ… ìˆ˜ì • ì™„ë£Œ ì‚¬í•­

### 1. í‘œì¤€í™” ì‹œ ë¶„ì‚° ê³„ì‚° ë° ê²½ê³  (`_standardize_factor_scores`)

**íŒŒì¼**: `src/analysis/hybrid_choice_model/iclv_models/sequential_estimator.py` (Line 1152-1221)

#### ì¶”ê°€ëœ ê¸°ëŠ¥:
- âœ… ì›ë³¸ ìš”ì¸ì ìˆ˜ì˜ **ë¶„ì‚°(variance)** ê³„ì‚°
- âœ… ë¶„ì‚° ì„ê³„ê°’ ì²´í¬ (ê¸°ë³¸ê°’: 0.01)
- âœ… ë¶„ì‚°ì´ ì‘ì€ ë³€ìˆ˜ì— ëŒ€í•œ **ê²½ê³  ë©”ì‹œì§€** ì¶œë ¥
- âœ… í‘œì¤€í™” ì „í›„ í‰ê· , ë¶„ì‚°, í‘œì¤€í¸ì°¨ ë¹„êµ ë¡œê¹…

#### ì¶œë ¥ ì˜ˆì‹œ:
```
ìš”ì¸ì ìˆ˜ Z-score í‘œì¤€í™”:
ë³€ìˆ˜                                    ì›ë³¸ í‰ê·         ì›ë³¸ ë¶„ì‚°       ì›ë³¸ std â†’       í‘œì¤€í™” í‰ê·        í‘œì¤€í™” ë¶„ì‚°      í‘œì¤€í™” std
------------------------------------------------------------------------------------------------------------------------
purchase_intention                   4.0410     1.367442       1.1694 â†’    -0.000000     1.000000     1.000000
perceived_benefit                    4.9929     0.754156       0.8684 â†’    -0.000000     1.000000     1.000000
health_consciousness                 5.4954     0.002775       0.0527 â†’     0.000000     1.000000     1.000000
perceived_price                      3.8058     0.005558       0.0746 â†’    -0.000000     1.000000     1.000000
------------------------------------------------------------------------------------------------------------------------
âœ… ëª¨ë“  ìš”ì¸ì ìˆ˜ê°€ í‰ê·  0, í‘œì¤€í¸ì°¨ 1ë¡œ í‘œì¤€í™”ë¨

âš ï¸  ë¶„ì‚°ì´ ë„ˆë¬´ ì‘ì€ ìš”ì¸ì ìˆ˜ ë°œê²¬:
   (ì„ê³„ê°’: 0.01)
   - health_consciousness: ë¶„ì‚° = 0.002775
   - perceived_price: ë¶„ì‚° = 0.005558
   â†’ ì„ íƒëª¨ë¸ì—ì„œ ë¹„ìœ ì˜í•  ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.
   â†’ ì¸¡ì •ëª¨ë¸ ì¬ê²€í†  ë˜ëŠ” ì§€í‘œ ì¶”ê°€ë¥¼ ê³ ë ¤í•˜ì„¸ìš”.
```

### 2. ê²°ê³¼ ì €ì¥ ì‹œ ë¶„ì‚° ì •ë³´ í¬í•¨ (`save_stage1_results`)

**íŒŒì¼**: `src/analysis/hybrid_choice_model/iclv_models/sequential_estimator.py` (Line 1343-1372)

#### ì¶”ê°€ëœ ê¸°ëŠ¥:
- âœ… `*_factor_scores_stats.csv` íŒŒì¼ì— **variance** ì»¬ëŸ¼ ì¶”ê°€
- âœ… **low_variance_warning** ì»¬ëŸ¼ ì¶”ê°€ (YES/NO)
- âœ… ì €ì¥ ì‹œ ë¶„ì‚°ì´ ì‘ì€ ë³€ìˆ˜ ê°œìˆ˜ ë¡œê·¸ ì¶œë ¥

#### ì €ì¥ë˜ëŠ” CSV êµ¬ì¡°:
```csv
latent_variable,mean,variance,std,min,max,n_observations,low_variance_warning
purchase_intention,4.041043,1.367442,1.169377,1.047223,7.792194,326,NO
perceived_benefit,4.992931,0.754156,0.868421,2.695069,7.470716,326,NO
health_consciousness,5.495359,0.002775,0.052680,5.325280,5.738898,326,YES
perceived_price,3.805751,0.005558,0.074551,3.620607,4.023056,326,YES
```

## ğŸ“Š ì €ì¥ë˜ëŠ” íŒŒì¼ ëª©ë¡

1ë‹¨ê³„ ê²°ê³¼ ì €ì¥ ì‹œ ë‹¤ìŒ íŒŒì¼ë“¤ì´ ìƒì„±ë©ë‹ˆë‹¤:

```
results/sequential_stage_wise/
â”œâ”€â”€ stage1_*_results.pkl                          # ì „ì²´ ê²°ê³¼ (pickle)
â”œâ”€â”€ stage1_*_results_paths.csv                    # ê²½ë¡œê³„ìˆ˜
â”œâ”€â”€ stage1_*_results_loadings.csv                 # ìš”ì¸ì ì¬ëŸ‰
â”œâ”€â”€ stage1_*_results_fit_indices.csv              # ì í•©ë„ ì§€ìˆ˜
â”œâ”€â”€ stage1_*_results_factor_scores_stats.csv      # â­ ìš”ì¸ì ìˆ˜ í†µê³„ (ë¶„ì‚° í¬í•¨)
â””â”€â”€ stage1_*_results_factor_scores.csv            # ìš”ì¸ì ìˆ˜ ì „ì²´ (326ëª…)
```

## ğŸ¯ ì‚¬ìš© ë°©ë²•

### ê¸°ì¡´ ì½”ë“œ ê·¸ëŒ€ë¡œ ì‚¬ìš© ê°€ëŠ¥

ìˆ˜ì • ì‚¬í•­ì€ **ìë™ìœ¼ë¡œ ì ìš©**ë˜ë¯€ë¡œ ê¸°ì¡´ ì½”ë“œë¥¼ ë³€ê²½í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤:

```python
from src.analysis.hybrid_choice_model.iclv_models import SequentialEstimator

# 1ë‹¨ê³„ ì¶”ì • (ê¸°ì¡´ ì½”ë“œ ê·¸ëŒ€ë¡œ)
results = estimator.estimate_stage1_only(
    data=data,
    measurement_model=measurement_model,
    structural_model=structural_model
)

# ê²°ê³¼ ì €ì¥ (ë¶„ì‚° ì •ë³´ ìë™ í¬í•¨)
saved_path = SequentialEstimator.save_stage1_results(
    results, 
    'results/sequential_stage_wise/stage1_results.pkl'
)
```

### ì €ì¥ëœ í†µê³„ íŒŒì¼ í™•ì¸

```python
import pandas as pd

# í†µê³„ íŒŒì¼ ë¡œë“œ
stats_df = pd.read_csv('results/sequential_stage_wise/stage1_*_factor_scores_stats.csv')

# ë¶„ì‚°ì´ ì‘ì€ ë³€ìˆ˜ í™•ì¸
low_var = stats_df[stats_df['low_variance_warning'] == 'YES']
print(low_var[['latent_variable', 'variance']])
```

## ğŸ”§ ë¶„ì‚° ì„ê³„ê°’ ì¡°ì • (ì„ íƒì‚¬í•­)

ê¸°ë³¸ ì„ê³„ê°’ì€ **0.01**ì´ì§€ë§Œ, í•„ìš”ì‹œ ì½”ë“œì—ì„œ ì¡°ì • ê°€ëŠ¥í•©ë‹ˆë‹¤:

**íŒŒì¼**: `src/analysis/hybrid_choice_model/iclv_models/sequential_estimator.py`

```python
# Line 1179: _standardize_factor_scores ë©”ì„œë“œ
variance_threshold = 0.01  # ì´ ê°’ì„ ì¡°ì •

# Line 1347: save_stage1_results ë©”ì„œë“œ
variance_threshold = 0.01  # ì´ ê°’ì„ ì¡°ì •
```

## ğŸ“ˆ í•´ì„ ê°€ì´ë“œ

### ë¶„ì‚°ì´ ì‘ë‹¤ëŠ” ê²ƒì˜ ì˜ë¯¸

- **ë¶„ì‚° < 0.01**: 326ëª…ì˜ ì‘ë‹µì ê°„ ìš”ì¸ì ìˆ˜ ì°¨ì´ê°€ ê±°ì˜ ì—†ìŒ
- **ì›ì¸**: 
  - ì¸¡ì • ì§€í‘œë“¤ì´ ëª¨ë‘ ë¹„ìŠ·í•œ ê°’ìœ¼ë¡œ ì‘ë‹µë¨
  - ì—­ì½”ë”© ë¬¸ì œ
  - ì§€í‘œ ê°„ ìƒê´€ê´€ê³„ê°€ ë„ˆë¬´ ë†’ìŒ
  - ì‘ë‹µì ê°„ ì´ì§ˆì„±ì´ ë¶€ì¡±í•¨

### ëŒ€ì‘ ë°©ì•ˆ

1. **ì¸¡ì •ëª¨ë¸ ì¬ê²€í† **
   - ì§€í‘œë“¤ì´ ì œëŒ€ë¡œ ì¸¡ì •ë˜ê³  ìˆëŠ”ì§€ í™•ì¸
   - ì—­ì½”ë”© í•­ëª© í™•ì¸
   - ì§€í‘œ ê°„ ìƒê´€ê´€ê³„ ë¶„ì„

2. **ì§€í‘œ ì¶”ê°€/ë³€ê²½**
   - ë” ë‹¤ì–‘í•œ ì¸¡ì • ì§€í‘œ ì¶”ê°€
   - ë³€ë³„ë ¥ ìˆëŠ” ë¬¸í•­ìœ¼ë¡œ êµì²´

3. **ë°ì´í„° í™•ì¸**
   - ì‘ë‹µ íŒ¨í„´ ë¶„ì„
   - ì´ìƒì¹˜ í™•ì¸
   - ê²°ì¸¡ì¹˜ ì²˜ë¦¬ ë°©ë²• ì¬ê²€í† 

## âœ… í…ŒìŠ¤íŠ¸ ì™„ë£Œ

í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ì—¬ ê¸°ëŠ¥ì„ ê²€ì¦í–ˆìŠµë‹ˆë‹¤:

```bash
python scripts/test_variance_check.py
```

**í…ŒìŠ¤íŠ¸ ê²°ê³¼**:
- âœ… ë¶„ì‚° ê³„ì‚° ì •ìƒ ì‘ë™
- âœ… ê²½ê³  ë©”ì‹œì§€ ì •ìƒ ì¶œë ¥
- âœ… CSV íŒŒì¼ì— ë¶„ì‚° ì •ë³´ ì €ì¥ í™•ì¸
- âœ… low_variance_warning í”Œë˜ê·¸ ì •ìƒ ì‘ë™

## ğŸ“ ê´€ë ¨ ë¬¸ì„œ

- ìƒì„¸ ê°€ì´ë“œ: `docs/FACTOR_SCORE_VARIANCE_CHECK_UPDATE.md`
- í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸: `scripts/test_variance_check.py`
- ìˆ˜ì •ëœ íŒŒì¼: `src/analysis/hybrid_choice_model/iclv_models/sequential_estimator.py`

## ğŸ” ì½”ë“œ ìˆ˜ì • ìœ„ì¹˜

1. **Line 1152-1221**: `_standardize_factor_scores` ë©”ì„œë“œ
   - ë¶„ì‚° ê³„ì‚° ë° ê²½ê³  ë¡œì§ ì¶”ê°€
   
2. **Line 1343-1372**: `save_stage1_results` ë©”ì„œë“œ
   - í†µê³„ íŒŒì¼ì— ë¶„ì‚° ì •ë³´ ì¶”ê°€

## ğŸ’¡ ì¶”ê°€ ê°œì„  ì œì•ˆ

í–¥í›„ í•„ìš”ì‹œ ë‹¤ìŒ ê¸°ëŠ¥ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

1. **ë¶„ì‚° ì„ê³„ê°’ ì„¤ì • íŒŒë¼ë¯¸í„°í™”**: Configì—ì„œ ì„ê³„ê°’ ì„¤ì • ê°€ëŠ¥í•˜ë„ë¡
2. **ìë™ ì§„ë‹¨ ë¦¬í¬íŠ¸**: ë¶„ì‚°ì´ ì‘ì€ ë³€ìˆ˜ì— ëŒ€í•œ ìƒì„¸ ì§„ë‹¨ ë¦¬í¬íŠ¸ ìƒì„±
3. **ì‹œê°í™”**: ìš”ì¸ì ìˆ˜ ë¶„í¬ íˆìŠ¤í† ê·¸ë¨ ìë™ ìƒì„±

---

**ì‘ì„±ì¼**: 2025-11-16  
**ì‘ì„±ì**: Augment Agent  
**ë²„ì „**: 1.0

