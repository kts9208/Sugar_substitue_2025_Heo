# μ„ νƒλ¨λΈ κ³„μ‚° λ΅μ§ (MultinomialLogitChoice)

## π“‹ κ°μ”

μμ°¨μ¶”μ • Step 2μ—μ„ μ‚¬μ©λλ” **Multinomial Logit μ„ νƒλ¨λΈ**μ κ³„μ‚° λ΅μ§μ„ μ„¤λ…ν•©λ‹λ‹¤.

---

## π“ μ‹¤μ  λ°μ΄ν„° κµ¬μ΅°

### **μ „μ²΄ λ°μ΄ν„° κ°μ”**

```
λ°μ΄ν„° νμΌ: data/processed/iclv/integrated_data.csv
μ΄ ν–‰ μ: 5,904ν–‰
μ΄ μ‘λ‹µμ μ: 326λ…
μ„ νƒ μ„ΈνΈ μ: 6κ° (κ° μ‘λ‹µμλ‹Ή)
κ°μΈλ‹Ή ν–‰ μ: 18ν–‰ (6κ° μ„ νƒ μ„ΈνΈ Γ— 3κ° λ€μ•)
```

### **μ„ νƒ μ„ΈνΈ 1 μμ‹ (κ°μΈ 1)**

| alternative | alternative_name | sugar_content | sugar_free | health_label | price | choice |
|-------------|------------------|---------------|------------|--------------|-------|--------|
| 1 | μ ν’ A | λ¬΄μ„¤νƒ• | 1.0 | 1.0 | 2.5 | **1** β… |
| 2 | μ ν’ B | μΌλ°λ‹Ή | 0.0 | 0.0 | 2.0 | 0 |
| 3 | κµ¬λ§¤μ•ν•¨ | NaN | NaN | NaN | NaN | 0 |

**ν•΄μ„**:
- **μ ν’ A**: λ¬΄μ„¤νƒ•, κ±΄κ°• λΌλ²¨ μμ, 2,500μ› β†’ **μ„ νƒλ¨** β…
- **μ ν’ B**: μΌλ°λ‹Ή, κ±΄κ°• λΌλ²¨ μ—†μ, 2,000μ›
- **κµ¬λ§¤μ•ν•¨**: μ†μ„± μ—†μ (κΈ°μ¤€ λ€μ•)

### **μ„ νƒ μ„ΈνΈ 2 μμ‹ (κ°μΈ 1)**

| alternative | alternative_name | sugar_content | sugar_free | health_label | price | choice |
|-------------|------------------|---------------|------------|--------------|-------|--------|
| 1 | μ ν’ A | μ•λ°λ‹Ή | 0.0 | 0.0 | 3.0 | 0 |
| 2 | μ ν’ B | λ¬΄μ„¤νƒ• | 1.0 | 1.0 | 2.5 | **1** β… |
| 3 | κµ¬λ§¤μ•ν•¨ | NaN | NaN | NaN | NaN | 0 |

**ν•΄μ„**:
- **μ ν’ A**: μΌλ°λ‹Ή, κ±΄κ°• λΌλ²¨ μ—†μ, 3,000μ›
- **μ ν’ B**: λ¬΄μ„¤νƒ•, κ±΄κ°• λΌλ²¨ μμ, 2,500μ› β†’ **μ„ νƒλ¨** β…
- **κµ¬λ§¤μ•ν•¨**: μ†μ„± μ—†μ (κΈ°μ¤€ λ€μ•)

### **μ†μ„± λ³€μ λ¶„ν¬**

#### **1. sugar_free (λ¬΄μ„¤νƒ• μ—¬λ¶€)**

```
0.0 (μΌλ°λ‹Ή): 1,968κ° (33.3%)
1.0 (λ¬΄μ„¤νƒ•): 1,968κ° (33.3%)
NaN (κµ¬λ§¤μ•ν•¨): 1,968κ° (33.3%)
```

- **0**: μΌλ°λ‹Ή μ ν’
- **1**: λ¬΄μ„¤νƒ• μ ν’
- **NaN**: κµ¬λ§¤μ•ν•¨ λ€μ• (μ†μ„± μ—†μ)

#### **2. health_label (κ±΄κ°• λΌλ²¨ μ λ¬΄)**

```
0.0 (μ—†μ): 1,968κ° (33.3%)
1.0 (μμ): 1,968κ° (33.3%)
NaN (κµ¬λ§¤μ•ν•¨): 1,968κ° (33.3%)
```

- **0**: κ±΄κ°• λΌλ²¨ μ—†μ
- **1**: κ±΄κ°• λΌλ²¨ μμ
- **NaN**: κµ¬λ§¤μ•ν•¨ λ€μ•

#### **3. price (κ°€κ²©, μ²μ› λ‹¨μ„)**

```
2.0 (2,000μ›): 1,312κ° (22.2%)
2.5 (2,500μ›): 1,312κ° (22.2%)
3.0 (3,000μ›): 1,312κ° (22.2%)
NaN (κµ¬λ§¤μ•ν•¨): 1,968κ° (33.3%)
```

- **2.0**: 2,000μ›
- **2.5**: 2,500μ›
- **3.0**: 3,000μ›
- **NaN**: κµ¬λ§¤μ•ν•¨ λ€μ•

**μ°Έκ³ **: κ°€κ²©μ€ μ΄λ―Έ 1000μΌλ΅ λ‚λ„μ–΄μ Έ μμ (2.0 = 2,000μ›)

---

### **6κ° μ„ νƒ μ„ΈνΈ μ„¤κ³„**

| μ„ νƒ μ„ΈνΈ | μ ν’ A | μ ν’ B |
|----------|--------|--------|
| **1** | λ¬΄μ„¤νƒ•, λΌλ²¨ μμ, 2,500μ› | μΌλ°λ‹Ή, λΌλ²¨ μ—†μ, 2,000μ› |
| **2** | μΌλ°λ‹Ή, λΌλ²¨ μ—†μ, 3,000μ› | λ¬΄μ„¤νƒ•, λΌλ²¨ μμ, 2,500μ› |
| **3** | λ¬΄μ„¤νƒ•, λΌλ²¨ μ—†μ, 2,000μ› | λ¬΄μ„¤νƒ•, λΌλ²¨ μμ, 3,000μ› |
| **4** | μΌλ°λ‹Ή, λΌλ²¨ μμ, 2,000μ› | μΌλ°λ‹Ή, λΌλ²¨ μ—†μ, 2,500μ› |
| **5** | λ¬΄μ„¤νƒ•, λΌλ²¨ μ—†μ, 2,500μ› | μΌλ°λ‹Ή, λΌλ²¨ μμ, 3,000μ› |
| **6** | μΌλ°λ‹Ή, λΌλ²¨ μμ, 3,000μ› | λ¬΄μ„¤νƒ•, λΌλ²¨ μ—†μ, 2,000μ› |

**μ„¤κ³„ νΉμ§•**:
- κ° μ„ νƒ μ„ΈνΈλ” μ„λ΅ λ‹¤λ¥Έ μ†μ„± μ΅°ν•©
- λ¨λ“  μ„ νƒ μ„ΈνΈμ— "κµ¬λ§¤μ•ν•¨" μµμ… ν¬ν•¨
- κ· ν• μ„¤κ³„ (κ° μ†μ„± μμ¤€μ΄ κ· λ“±ν•κ² λ¶„ν¬)

---

### **λ°μ΄ν„° κµ¬μ΅° μ”μ•½**

```python
# κ° μ‘λ‹µμλ” 6κ° μ„ νƒ μ„ΈνΈμ—μ„ μ„ νƒ
# κ° μ„ νƒ μ„ΈνΈλ” 3κ° λ€μ• (μ ν’A, μ ν’B, κµ¬λ§¤μ•ν•¨)
# μ΄ λ°μ΄ν„°: 326λ… Γ— 6κ° μ„ νƒ μ„ΈνΈ Γ— 3κ° λ€μ• = 5,904ν–‰

λ°μ΄ν„° κµ¬μ΅°:
  respondent_id: 1, 1, 1, 1, 1, 1, ..., 326, 326, 326
  choice_set:    1, 1, 1, 2, 2, 2, ..., 6, 6, 6
  alternative:   1, 2, 3, 1, 2, 3, ..., 1, 2, 3
  choice:        1, 0, 0, 0, 1, 0, ..., 0, 0, 1
```

---

## π― λ¨λΈ κµ¬μ΅°

### **ν¨μ©ν•¨μ (Utility Function)**

```
V_ij = intercept + Ξ²*X_ij + Ξ»_main*PI_i + Ξ»_mod_PP*(PI_i Γ— PP_i) + Ξ»_mod_NK*(PI_i Γ— NK_i)
```

**μ—¬κΈ°μ„**:
- `i`: κ°μΈ μΈλ±μ¤ (1, 2, ..., N)
- `j`: λ€μ• μΈλ±μ¤ (1=μ ν’A, 2=μ ν’B, 3=κµ¬λ§¤μ•ν•¨)
- `V_ij`: κ°μΈ iκ°€ λ€μ• jλ¥Ό μ„ νƒν•  λ•μ ν¨μ©
- `X_ij`: λ€μ• jμ μ†μ„± λ²΅ν„° (sugar_free, health_label, price)
- `Ξ²`: μ†μ„± κ³„μ λ²΅ν„°
- `PI_i`: κ°μΈ iμ κµ¬λ§¤μλ„ μ”μΈμ μ (μ£Όν¨κ³Ό)
- `PP_i`: κ°μΈ iμ μ§€κ°λ κ°€κ²© μ”μΈμ μ (μ΅°μ ν¨κ³Ό)
- `NK_i`: κ°μΈ iμ μμ–‘μ§€μ‹ μ”μΈμ μ (μ΅°μ ν¨κ³Ό)
- `Ξ»_main`: κµ¬λ§¤μλ„ μ£Όν¨κ³Ό κ³„μ
- `Ξ»_mod_PP`: μ§€κ°λ κ°€κ²© μ΅°μ ν¨κ³Ό κ³„μ
- `Ξ»_mod_NK`: μμ–‘μ§€μ‹ μ΅°μ ν¨κ³Ό κ³„μ

### **μ„ νƒ ν™•λ¥  (Choice Probability)**

```
P(y_i = j) = exp(V_ij) / Ξ£_k exp(V_ik)
```

**Softmax ν•¨μ**λ¥Ό μ‚¬μ©ν•μ—¬ κ° λ€μ•μ μ„ νƒ ν™•λ¥ μ„ κ³„μ‚°ν•©λ‹λ‹¤.

### **λ΅κ·Έμ°λ„ (Log-Likelihood)**

```
LL = Ξ£_i Ξ£_j y_ij * log(P(y_i = j))
```

**μ—¬κΈ°μ„**:
- `y_ij`: κ°μΈ iκ°€ λ€μ• jλ¥Ό μ„ νƒν–μΌλ©΄ 1, μ•„λ‹λ©΄ 0

---

## π”Ά κ³„μ‚° κ³Όμ •

### **Step 1: λ°μ΄ν„° μ¤€λΉ„**

#### **μ…λ ¥ λ°μ΄ν„° κµ¬μ΅° (μ‹¤μ  λ°μ΄ν„°)**

**μ„ νƒ λ°μ΄ν„°** (`data`):
```
   respondent_id  choice_set  alternative  sugar_free  health_label  price  choice
0              1           1            1         0.0           1.0    2.5       1
1              1           1            2         1.0           0.0    2.0       0
2              1           1            3         NaN           NaN    NaN       0
3              1           2            1         0.0           0.0    3.0       0
4              1           2            2         1.0           1.0    2.5       1
5              1           2            3         NaN           NaN    NaN       0
...
```

**λ°μ΄ν„° νΉμ§•**:
- κ° μ„ νƒ μ„ΈνΈλ” **3κ° ν–‰** (μ ν’A, μ ν’B, κµ¬λ§¤μ•ν•¨)
- `choice=1`: μ„ νƒλ λ€μ•
- κµ¬λ§¤μ•ν•¨ λ€μ•: μ†μ„±μ΄ NaN β†’ ν¨μ© = 0 (κΈ°μ¤€ λ€μ•)
- μ΄ 326λ… Γ— 6κ° μ„ νƒ μ„ΈνΈ Γ— 3κ° λ€μ• = 5,904ν–‰

**μ‹¤μ  μμ‹ (κ°μΈ 1, μ„ νƒ μ„ΈνΈ 1)**:
- **μ ν’ A**: λ¬΄μ„¤νƒ•(1), κ±΄κ°•λΌλ²¨ μμ(1), 2,500μ› β†’ **μ„ νƒλ¨** β…
- **μ ν’ B**: μΌλ°λ‹Ή(0), κ±΄κ°•λΌλ²¨ μ—†μ(0), 2,000μ›
- **κµ¬λ§¤μ•ν•¨**: μ†μ„± μ—†μ

**μ”μΈμ μ** (`factor_scores`):
```python
{
    'purchase_intention': np.array([0.5, -0.3, 1.2, ...]),  # (N,)
    'perceived_price': np.array([0.2, 0.8, -0.5, ...]),    # (N,)
    'nutrition_knowledge': np.array([1.0, 0.3, -0.2, ...]) # (N,)
}
```

- κ° κ°μΈλ‹Ή **1κ° κ°’**
- SEM Step 1μ—μ„ μ¶”μ¶λ¨

#### **μ”μΈμ μ ν™•μ¥**

μ„ νƒ λ°μ΄ν„°λ” κ°μΈλ‹Ή 3κ° ν–‰μ΄λ―€λ΅, μ”μΈμ μλ¥Ό λ³µμ ν•©λ‹λ‹¤:

```python
# μ›λ³Έ: (N,)
PI = np.array([0.5, -0.3, 1.2])

# ν™•μ¥: (N*3,) - κ° κ°’μ„ 3λ² λ°λ³µ
PI_expanded = np.array([0.5, 0.5, 0.5, -0.3, -0.3, -0.3, 1.2, 1.2, 1.2])
```

---

### **Step 2: ν¨μ© κ³„μ‚°**

#### **2.1 μ†μ„± ν¨μ©**

```python
# μ„ νƒ μ†μ„± μ¶”μ¶
X = data[['sugar_free', 'health_label', 'price']].values  # (N*3, 3)

# μ†μ„± ν¨μ©
U_attr = intercept + X @ beta  # (N*3,)
```

**μμ‹ (μ‹¤μ  λ°μ΄ν„°: κ°μΈ 1, μ„ νƒ μ„ΈνΈ 1)**:
```
beta = [-0.856, 0.423, -1.987]  # [Ξ²_sugar_free, Ξ²_health_label, Ξ²_price]
intercept = 0.234

κ°μΈ 1, μ„ νƒ μ„ΈνΈ 1, λ€μ• 1 (μ ν’A):
  X = [1.0, 1.0, 2.5]  # λ¬΄μ„¤νƒ•, κ±΄κ°•λΌλ²¨ μμ, 2,500μ›
  U_attr = 0.234 + 1.0*(-0.856) + 1.0*0.423 + 2.5*(-1.987)
         = 0.234 + (-0.856) + 0.423 + (-4.968)
         = -5.167

κ°μΈ 1, μ„ νƒ μ„ΈνΈ 1, λ€μ• 2 (μ ν’B):
  X = [0.0, 0.0, 2.0]  # μΌλ°λ‹Ή, κ±΄κ°•λΌλ²¨ μ—†μ, 2,000μ›
  U_attr = 0.234 + 0.0*(-0.856) + 0.0*0.423 + 2.0*(-1.987)
         = 0.234 + 0.0 + 0.0 + (-3.974)
         = -3.740

κ°μΈ 1, μ„ νƒ μ„ΈνΈ 1, λ€μ• 3 (κµ¬λ§¤μ•ν•¨):
  X = [NaN, NaN, NaN]
  U_attr = 0.0  # κΈ°μ¤€ λ€μ• (ν¨μ© = 0μΌλ΅ κ³ μ •)
```

**ν•΄μ„**:
- μ ν’Bκ°€ μ ν’Aλ³΄λ‹¤ μ†μ„± ν¨μ©μ΄ λ†’μ (-3.740 > -5.167)
- ν•μ§€λ§ λ‘ λ‹¤ κµ¬λ§¤μ•ν•¨(0.0)λ³΄λ‹¤ λ‚®μ
- μµμΆ… μ„ νƒμ€ μ μ¬λ³€μ ν¨κ³Όλ¥Ό ν¬ν•¨ν• ν›„ κ²°μ •λ¨

#### **2.2 μ μ¬λ³€μ ν¨μ© (μ£Όν¨κ³Ό)**

```python
# κµ¬λ§¤μλ„ μ£Όν¨κ³Ό
U_main = lambda_main * PI_expanded  # (N*3,)
```

**μμ‹ (μ‹¤μ  λ°μ΄ν„°: κ°μΈ 1)**:
```
lambda_main = 1.234
PI_i = 0.5  # κ°μΈ 1μ κµ¬λ§¤μλ„ μ”μΈμ μ

κ°μΈ 1, λ¨λ“  λ€μ•:
  U_main = 1.234 * 0.5 = 0.617  # λ¨λ“  λ€μ•μ— λ™μΌν•κ² μ μ©
```

**μ°Έκ³ **: κµ¬λ§¤μλ„λ” κ°μΈ νΉμ„±μ΄λ―€λ΅ κ°™μ€ κ°μΈμ λ¨λ“  λ€μ•μ— λ™μΌν• κ°’μ΄ μ μ©λ©λ‹λ‹¤.

#### **2.3 μ΅°μ ν¨κ³Ό**

```python
# μ§€κ°λ κ°€κ²© μ΅°μ ν¨κ³Ό
interaction_PP = PI_expanded * PP_expanded  # (N*3,)
U_mod_PP = lambda_mod_PP * interaction_PP   # (N*3,)

# μμ–‘μ§€μ‹ μ΅°μ ν¨κ³Ό
interaction_NK = PI_expanded * NK_expanded  # (N*3,)
U_mod_NK = lambda_mod_NK * interaction_NK   # (N*3,)
```

**μμ‹ (μ‹¤μ  λ°μ΄ν„°: κ°μΈ 1)**:
```
lambda_mod_PP = -0.287  # κ°€κ²© μμ¤€μ΄ λ†’μ„μλ΅ κµ¬λ§¤μλ„ ν¨κ³Ό κ°μ†
lambda_mod_NK = 0.156   # μμ–‘μ§€μ‹μ΄ λ†’μ„μλ΅ κµ¬λ§¤μλ„ ν¨κ³Ό μ¦κ°€

κ°μΈ 1μ μ”μΈμ μ:
  PI_i = 0.5   # κµ¬λ§¤μλ„
  PP_i = 0.2   # μ§€κ°λ κ°€κ²©
  NK_i = 1.0   # μμ–‘μ§€μ‹

μ΅°μ ν¨κ³Ό κ³„μ‚°:
  interaction_PP = PI_i Γ— PP_i = 0.5 Γ— 0.2 = 0.1
  U_mod_PP = -0.287 Γ— 0.1 = -0.0287

  interaction_NK = PI_i Γ— NK_i = 0.5 Γ— 1.0 = 0.5
  U_mod_NK = 0.156 Γ— 0.5 = 0.078

κ°μΈ 1, λ¨λ“  λ€μ•:
  μ΄ μ΅°μ ν¨κ³Ό = -0.0287 + 0.078 = 0.0493
```

**ν•΄μ„**:
- **μ§€κ°λ κ°€κ²© μ΅°μ ν¨κ³Ό**: -0.0287 (λ¶€μ  μ΅°μ )
  - κ°€κ²©μ΄ λΉ„μ‹Έλ‹¤κ³  λλ‚„μλ΅ κµ¬λ§¤μλ„μ ν¨κ³Όκ°€ κ°μ†
- **μμ–‘μ§€μ‹ μ΅°μ ν¨κ³Ό**: 0.078 (μ •μ  μ΅°μ )
  - μμ–‘μ§€μ‹μ΄ λ†’μ„μλ΅ κµ¬λ§¤μλ„μ ν¨κ³Όκ°€ μ¦κ°€
- **μ μ΅°μ ν¨κ³Ό**: 0.0493 (μ–‘μ)
  - μ΄ κ°μΈμ κ²½μ° μμ–‘μ§€μ‹ ν¨κ³Όκ°€ κ°€κ²© ν¨κ³Όλ³΄λ‹¤ νΌ

#### **2.4 μ΄ ν¨μ©**

```python
V = U_attr + U_main + U_mod_PP + U_mod_NK  # (N*3,)
```

**μμ‹ (μ‹¤μ  λ°μ΄ν„°: κ°μΈ 1, μ„ νƒ μ„ΈνΈ 1)**:
```
κ°μΈ 1, μ„ νƒ μ„ΈνΈ 1, λ€μ• 1 (μ ν’A):
  V = U_attr + U_main + U_mod
    = -5.167 + 0.617 + 0.0493
    = -4.501

κ°μΈ 1, μ„ νƒ μ„ΈνΈ 1, λ€μ• 2 (μ ν’B):
  V = U_attr + U_main + U_mod
    = -3.740 + 0.617 + 0.0493
    = -3.074

κ°μΈ 1, μ„ νƒ μ„ΈνΈ 1, λ€μ• 3 (κµ¬λ§¤μ•ν•¨):
  V = U_attr + U_main + U_mod
    = 0.0 + 0.617 + 0.0493
    = 0.666
```

**ν¨μ© λΉ„κµ**:
- κµ¬λ§¤μ•ν•¨: **0.666** (κ°€μ¥ λ†’μ)
- μ ν’B: -3.074
- μ ν’A: -4.501 (κ°€μ¥ λ‚®μ)

**μμƒ μ„ νƒ**: κµ¬λ§¤μ•ν•¨ (ν¨μ©μ΄ κ°€μ¥ λ†’μ)
**μ‹¤μ  μ„ νƒ**: μ ν’A β…

**μ°Έκ³ **: μ΄λ” μμ‹ νλΌλ―Έν„°λ¥Ό μ‚¬μ©ν• κ²ƒμ΄λ©°, μ‹¤μ  μ¶”μ •λ νλΌλ―Έν„°λ” λ‹¤λ¥Ό μ μμµλ‹λ‹¤. λν• ν™•λ¥ μ  μ„ νƒ λ¨λΈμ΄λ―€λ΅ ν¨μ©μ΄ κ°€μ¥ λ†’μ€ λ€μ•μ΄ ν•­μƒ μ„ νƒλλ” κ²ƒμ€ μ•„λ‹™λ‹λ‹¤.

---

### **Step 3: μ„ νƒ ν™•λ¥  κ³„μ‚° (Softmax)**

```python
# κ°μΈλ³„λ΅ κ·Έλ£Ήν™”
for i in range(n_individuals):
    # μ΄ κ°μΈμ 3κ° λ€μ• ν¨μ©
    V_i = V[i*3:(i+1)*3]  # (3,)
    
    # Softmax (μμΉ μ•μ •μ„±μ„ μ„ν•΄ μµλ€κ°’ λΉΌκΈ°)
    V_max = np.max(V_i)
    exp_V = np.exp(V_i - V_max)
    P_i = exp_V / np.sum(exp_V)  # (3,)
```

**μμ‹ (μ‹¤μ  λ°μ΄ν„°: κ°μΈ 1, μ„ νƒ μ„ΈνΈ 1)**:
```
κ°μΈ 1, μ„ νƒ μ„ΈνΈ 1:
  V = [-4.501, -3.074, 0.666]
  V_max = 0.666

  exp_V = [exp(-4.501-0.666), exp(-3.074-0.666), exp(0.666-0.666)]
        = [exp(-5.167), exp(-3.740), exp(0)]
        = [0.0057, 0.0238, 1.0000]

  sum(exp_V) = 0.0057 + 0.0238 + 1.0000 = 1.0295

  P = [0.0057, 0.0238, 1.0000] / 1.0295
    = [0.0055, 0.0231, 0.9714]
```

**μ„ νƒ ν™•λ¥ **:
- μ ν’A: **0.55%**
- μ ν’B: 2.31%
- κµ¬λ§¤μ•ν•¨: **97.14%**

**ν•΄μ„**:
- κµ¬λ§¤μ•ν•¨ ν™•λ¥ μ΄ μ••λ„μ μΌλ΅ λ†’μ (97.14%)
- μ ν’Bκ°€ μ ν’Aλ³΄λ‹¤ λ†’μ€ μ„ νƒ ν™•λ¥  (2.31% vs 0.55%)
- μ‹¤μ λ΅λ” μ ν’Aκ°€ μ„ νƒλμ—μΌλ―€λ΅, λ‚®μ€ ν™•λ¥ (0.55%)μ—λ„ λ¶κµ¬ν•κ³  μ„ νƒλ¨

---

### **Step 4: λ΅κ·Έμ°λ„ κ³„μ‚°**

```python
total_ll = 0.0

for i in range(n_individuals):
    # μ„ νƒλ λ€μ• μ°ΎκΈ°
    choices = data.loc[i*3:(i+1)*3-1, 'choice'].values
    chosen_idx = np.argmax(choices)  # 0, 1, or 2
    
    # μ„ νƒλ λ€μ•μ ν™•λ¥ 
    P_i = probabilities[i*3:(i+1)*3]
    P_chosen = P_i[chosen_idx]
    
    # λ΅κ·Έμ°λ„ λ„μ 
    total_ll += np.log(P_chosen)
```

**μμ‹ (μ‹¤μ  λ°μ΄ν„°)**:
```
κ°μΈ 1, μ„ νƒ μ„ΈνΈ 1: λ€μ• 1 (μ ν’A) μ„ νƒ
  P_chosen = 0.0132
  log(P_chosen) = log(0.0132) = -4.328

κ°μΈ 1, μ„ νƒ μ„ΈνΈ 2: λ€μ• 2 (μ ν’B) μ„ νƒ (κ°€μ •)
  P_chosen = 0.95
  log(P_chosen) = log(0.95) = -0.051

...

total_ll = Ξ£_{i=1}^{326} Ξ£_{s=1}^{6} log(P_chosen_{is})
         = -4.328 + (-0.051) + ... (1,956κ° μ„ νƒ μƒν™©)
         β‰ -1500 ~ -2000 (μμƒ λ²”μ„)
```

**μ°Έκ³ **:
- μ΄ μ„ νƒ μƒν™©: 326λ… Γ— 6κ° μ„ νƒ μ„ΈνΈ = 1,956κ°
- κ° μ„ νƒ μƒν™©λ§λ‹¤ μ„ νƒλ λ€μ•μ λ΅κ·Έ ν™•λ¥ μ„ ν•©μ‚°
- λ΅κ·Έμ°λ„λ” ν•­μƒ μμ (ν™•λ¥ μ€ 0~1 μ‚¬μ΄)

---

## π”§ μµμ ν™” (Parameter Estimation)

### **λ©μ ν•¨μ**

```python
def negative_log_likelihood(params_array):
    # λ°°μ—΄ β†’ λ”•μ…”λ„λ¦¬ λ³€ν™
    params = _array_to_params(param_names, params_array)
    
    # λ΅κ·Έμ°λ„ κ³„μ‚°
    ll = log_likelihood(data, lv_expanded, params)
    
    # μμ λ°ν™ (μµμ†ν™” λ¬Έμ λ΅ λ³€ν™)
    return -ll
```

### **μµμ ν™” μ•κ³ λ¦¬μ¦**

```python
result = minimize(
    negative_log_likelihood,
    x0,  # μ΄κΈ°κ°’
    method='L-BFGS-B',  # Limited-memory BFGS with Bounds
    options={'maxiter': 1000, 'disp': True}
)
```

**L-BFGS-B νΉμ§•**:
- λ€κ·λ¨ λ¬Έμ μ— ν¨μ¨μ 
- λ©”λ¨λ¦¬ μ‚¬μ©λ‰ μ μ
- κ²½κ³„ μ΅°κ±΄ μ§€μ› (ν•„μ”μ‹)

---

## οΏ½ ν‘μ¤€μ¤μ°¨ λ° p-value κ³„μ‚°

### **1. Hessian μ—­ν–‰λ ¬**

L-BFGS-B μµμ ν™” κ²°κ³Όμ—μ„ Hessian μ—­ν–‰λ ¬μ„ μ¶”μ¶:

```python
hess_inv = result.hess_inv  # (n_params, n_params)
```

**Hessian μ—­ν–‰λ ¬ = λ¶„μ‚°-κ³µλ¶„μ‚° ν–‰λ ¬**:
- λ€κ° μ›μ†: κ° νλΌλ―Έν„°μ λ¶„μ‚°
- λΉ„λ€κ° μ›μ†: νλΌλ―Έν„° κ°„ κ³µλ¶„μ‚°

### **2. ν‘μ¤€μ¤μ°¨ (Standard Error)**

```python
# λ€κ° μ›μ† μ¶”μ¶ (λ¶„μ‚°)
variances = np.diag(hess_inv)

# μμ λ¶„μ‚° μ²λ¦¬ (μμΉ μ¤λ¥ λ°©μ§€)
variances = np.maximum(variances, 1e-10)

# ν‘μ¤€μ¤μ°¨ = λ¶„μ‚°μ μ κ³±κ·Ό
se = np.sqrt(variances)
```

### **3. t-ν†µκ³„λ‰ (t-statistic)**

```python
t_statistics = estimates / se
```

**ν•΄μ„**:
- |t| > 1.96: 5% μ μμμ¤€μ—μ„ μ μ
- |t| > 2.58: 1% μ μμμ¤€μ—μ„ μ μ
- |t| > 3.29: 0.1% μ μμμ¤€μ—μ„ μ μ

### **4. p-value**

```python
from scipy.stats import norm

# μ–‘μΈ΅ κ²€μ • (λ€ν‘λ³Έμ΄λ―€λ΅ μ •κ·λ¶„ν¬ μ‚¬μ©)
p_values = 2 * (1 - norm.cdf(np.abs(t_statistics)))
```

**ν•΄μ„**:
- p < 0.001: *** (λ§¤μ° μ μ)
- p < 0.01: ** (μ μ)
- p < 0.05: * (μ•½ν• μ μ)
- p β‰¥ 0.05: μ μν•μ§€ μ•μ

### **5. κ²°κ³Ό μμ‹ (μƒν” λ°μ΄ν„°, n=100)**

| νλΌλ―Έν„° | μ¶”μ •κ°’ | ν‘μ¤€μ¤μ°¨ | t-κ°’ | p-κ°’ | μ μμ„± |
|---------|--------|---------|------|------|--------|
| intercept | 0.3501 | 1.3939 | 0.25 | 0.802 | |
| beta_sugar_free | -0.4725 | 1.0865 | -0.43 | 0.664 | |
| beta_health_label | 0.2042 | 0.4971 | 0.41 | 0.681 | |
| beta_price | -0.0696 | 0.4642 | -0.15 | 0.881 | |
| lambda_main | 0.2027 | 0.8082 | 0.25 | 0.802 | |
| lambda_mod_perceived_price | -0.0348 | 0.4123 | -0.08 | 0.933 | |
| lambda_mod_nutrition_knowledge | -0.0291 | 0.9376 | -0.03 | 0.975 | |

**μ°Έκ³ **:
- μ„ μμ‹λ” μƒν” λ°μ΄ν„°(100λ…)λ΅ μ¶”μ •ν• κ²°κ³Όμ΄λ―€λ΅ μ μν•μ§€ μ•μµλ‹λ‹¤.
- μ‹¤μ  λ°μ΄ν„°(326λ…, 1,956κ° μ„ νƒ μƒν™©)λ΅ μ¶”μ •ν•λ©΄ λ” μ •ν™•ν• κ²°κ³Όλ¥Ό μ–»μ„ μ μμµλ‹λ‹¤.
- ν‘μ¤€μ¤μ°¨λ” Hessian μ—­ν–‰λ ¬μ—μ„ μλ™μΌλ΅ κ³„μ‚°λ©λ‹λ‹¤.

---

## οΏ½π“ μ¶”μ • κ²°κ³Ό

### **νλΌλ―Έν„°**

```python
{
    'intercept': 0.234,
    'beta': np.array([-0.856, 0.423, -1.987]),  # [sugar_free, health_label, price]
    'lambda_main': 1.234,  # κµ¬λ§¤μλ„ μ£Όν¨κ³Ό
    'lambda_mod_perceived_price': -0.287,  # κ°€κ²© μ΅°μ ν¨κ³Ό (λ¶€μ )
    'lambda_mod_nutrition_knowledge': 0.156  # μ§€μ‹ μ΅°μ ν¨κ³Ό (μ •μ )
}
```

### **λ¨λΈ μ ν•©λ„**

```python
{
    'log_likelihood': -1234.56,
    'aic': 2480.12,  # 2*n_params - 2*LL
    'bic': 2510.34,  # n_params*log(n_obs) - 2*LL
    'n_params': 6,
    'n_obs': 326
}
```

---

## π’΅ ν•΄μ„

### **1. μ†μ„± κ³„μ (Ξ²)**

- `Ξ²_sugar_free = -0.856`: λ¬΄μ„¤νƒ• μ ν’μ— λ€ν• μ„ νΈλ„ **κ°μ†** (μμ)
- `Ξ²_health_label = 0.423`: κ±΄κ°• λΌλ²¨μ— λ€ν• μ„ νΈλ„ **μ¦κ°€** (μ–‘μ)
- `Ξ²_price = -1.987`: κ°€κ²©μ΄ λ†’μ„μλ΅ μ„ νΈλ„ **κ°μ†** (μμ, μμƒλ€λ΅)

### **2. κµ¬λ§¤μλ„ μ£Όν¨κ³Ό (Ξ»_main)**

- `Ξ»_main = 1.234`: κµ¬λ§¤μλ„κ°€ 1 μ¦κ°€ν•λ©΄ ν¨μ©μ΄ 1.234 μ¦κ°€
- **μ–‘μ**: κµ¬λ§¤μλ„κ°€ λ†’μ„μλ΅ μ ν’ μ„ νƒ ν™•λ¥  μ¦κ°€

### **3. μ΅°μ ν¨κ³Ό**

#### **μ§€κ°λ κ°€κ²© (Ξ»_mod_PP)**

- `Ξ»_mod_PP = -0.287` (**λ¶€μ  μ΅°μ **)
- μ§€κ°λ κ°€κ²©μ΄ λ†’μ„μλ΅ κµ¬λ§¤μλ„μ ν¨κ³Όκ°€ **κ°μ†**
- **ν•΄μ„**: "κ°€κ²©μ΄ λΉ„μ‹Έλ‹¤κ³  λλΌλ©΄, κµ¬λ§¤μλ„κ°€ λ†’μ•„λ„ μ‹¤μ  κµ¬λ§¤λ΅ μ΄μ–΄μ§€κΈ° μ–΄λ µλ‹¤"

#### **μμ–‘μ§€μ‹ (Ξ»_mod_NK)**

- `Ξ»_mod_NK = 0.156` (**μ •μ  μ΅°μ **)
- μμ–‘μ§€μ‹μ΄ λ†’μ„μλ΅ κµ¬λ§¤μλ„μ ν¨κ³Όκ°€ **μ¦κ°€**
- **ν•΄μ„**: "μμ–‘μ§€μ‹μ΄ λ†’μΌλ©΄, κµ¬λ§¤μλ„κ°€ μ‹¤μ  κµ¬λ§¤λ΅ λ” μ μ΄μ–΄μ§„λ‹¤"

---

**μ‘μ„±μΌ**: 2025-01-15  
**λ²„μ „**: 1.0  
**κ΄€λ ¨ νμΌ**: `src/analysis/hybrid_choice_model/iclv_models/choice_equations.py`

