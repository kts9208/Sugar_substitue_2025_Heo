# ğŸ“Š Ordered Probit ì¸¡ì •ëª¨ë¸ êµ¬í˜„ ì™„ë£Œ ë³´ê³ ì„œ

## ğŸ¯ ëª©í‘œ

King (2022) ë…¼ë¬¸ì˜ Apollo R ì½”ë“œë¥¼ ê¸°ë°˜ìœ¼ë¡œ Ordered Probit ì¸¡ì •ëª¨ë¸ì„ Pythonìœ¼ë¡œ ë™ì¼í•˜ê²Œ êµ¬í˜„

## âœ… ì™„ë£Œ ì‚¬í•­

### 1. **OrderedProbitMeasurement í´ë˜ìŠ¤ êµ¬í˜„**

**íŒŒì¼**: `src/analysis/hybrid_choice_model/iclv_models/measurement_equations.py`

**í•µì‹¬ ê¸°ëŠ¥**:
- âœ… Ordered Probit í™•ë¥  ê³„ì‚°
- âœ… ë¡œê·¸ìš°ë„ í•¨ìˆ˜
- âœ… ì ì¬ë³€ìˆ˜ ì˜ˆì¸¡
- âœ… ë²”ì£¼ í™•ë¥  ì˜ˆì¸¡
- âœ… ë‹¨ë… ì¶”ì • (Sequential ë°©ì‹ìš©)

### 2. **Apollo R ì½”ë“œì™€ì˜ ì™„ì „í•œ ë™ë“±ì„±**

#### Apollo R ì½”ë“œ:
```r
op_settings = list(
  outcomeOrdered = Q13,
  V = zeta_Q13 * LV,
  tau = c(tau_Q13_1, tau_Q13_2, tau_Q13_3, tau_Q13_4),
  componentName = "indic_Q13"
)
P[["indic_Q13"]] = apollo_op(op_settings, functionality)
```

#### Python êµ¬í˜„:
```python
prob = model._ordered_probit_probability(y, lv, zeta, tau)

# ë‚´ë¶€ ê³„ì‚°:
# V = zeta * lv
# if k == 0:
#     prob = Î¦(Ï„_1 - V)
# elif k == 4:
#     prob = 1 - Î¦(Ï„_4 - V)
# else:
#     prob = Î¦(Ï„_k - V) - Î¦(Ï„_{k-1} - V)
```

**ê²€ì¦ ê²°ê³¼**: ìˆ˜ë™ ê³„ì‚°ê³¼ ì°¨ì´ **0.0000000000** (ì™„ì „ ì¼ì¹˜)

---

## ğŸ“ ìˆ˜í•™ì  ëª¨ë¸

### Ordered Probit ì¸¡ì •ë°©ì •ì‹

```
P(Y_i = k) = Î¦(Ï„_k - Î¶*LV) - Î¦(Ï„_{k-1} - Î¶*LV)
```

**ì—¬ê¸°ì„œ**:
- `Y_i`: ê´€ì¸¡ì§€í‘œ (1, 2, 3, 4, 5 for 5-point Likert scale)
- `Ï„`: ì„ê³„ê°’ (thresholds) - ë²”ì£¼ ê²½ê³„ [Ï„â‚, Ï„â‚‚, Ï„â‚ƒ, Ï„â‚„]
- `Î¶`: ìš”ì¸ì ì¬ëŸ‰ (factor loadings)
- `LV`: ì ì¬ë³€ìˆ˜ (latent variable)
- `Î¦`: í‘œì¤€ì •ê·œ ëˆ„ì ë¶„í¬í•¨ìˆ˜

### ê²½ê³„ ì¡°ê±´

- **P(Y=1)** = Î¦(Ï„â‚ - Î¶*LV)
- **P(Y=2)** = Î¦(Ï„â‚‚ - Î¶*LV) - Î¦(Ï„â‚ - Î¶*LV)
- **P(Y=3)** = Î¦(Ï„â‚ƒ - Î¶*LV) - Î¦(Ï„â‚‚ - Î¶*LV)
- **P(Y=4)** = Î¦(Ï„â‚„ - Î¶*LV) - Î¦(Ï„â‚ƒ - Î¶*LV)
- **P(Y=5)** = 1 - Î¦(Ï„â‚„ - Î¶*LV)

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ê²°ê³¼

### TEST 1: í™•ë¥  ê³„ì‚° ê²€ì¦ âœ…

**íŒŒë¼ë¯¸í„°**:
- Î¶ = 1.0
- Ï„ = [-2.0, -1.0, 1.0, 2.0]

**ê²°ê³¼**:
```
    LV |   P(Y=1) |   P(Y=2) |   P(Y=3) |   P(Y=4) |   P(Y=5) |   í•©ê³„
----------------------------------------------------------------------
 -3.00 |   0.8413 |   0.1359 |   0.0227 |   0.0000 |   0.0000 |  1.0000
 -1.50 |   0.3085 |   0.3829 |   0.3023 |   0.0060 |   0.0002 |  1.0000
  0.00 |   0.0228 |   0.1359 |   0.6827 |   0.1359 |   0.0228 |  1.0000
  1.50 |   0.0002 |   0.0060 |   0.3023 |   0.3829 |   0.3085 |  1.0000
  3.00 |   0.0000 |   0.0000 |   0.0227 |   0.1359 |   0.8413 |  1.0000
```

**ê²€ì¦**:
- âœ… ëª¨ë“  í™•ë¥  í•© = 1.0
- âœ… ì ì¬ë³€ìˆ˜ ì¦ê°€ ì‹œ ë†’ì€ ë²”ì£¼ í™•ë¥  ì¦ê°€

### TEST 2: ë¡œê·¸ìš°ë„ ê³„ì‚° âœ…

**ë°ì´í„°**:
- ê´€ì¸¡ì¹˜ ìˆ˜: 100
- ì§€í‘œ ìˆ˜: 3 (Q13, Q14, Q15)

**ê²°ê³¼**:
- ë¡œê·¸ìš°ë„: -294.09
- âœ… ìœ í•œí•œ ìŒìˆ˜ ê°’

### TEST 3: Apollo R ì½”ë“œ ë™ë“±ì„± âœ…

**Apollo íŒŒë¼ë¯¸í„°**:
- zeta_Q13 = 1.0
- tau = [-2.0, -1.0, 1.0, 2.0]
- LV = 0.5

**í™•ë¥  ê³„ì‚° ê²°ê³¼**:
```
P(Q13=1 | LV=0.5) = 0.006210
P(Q13=2 | LV=0.5) = 0.060598
P(Q13=3 | LV=0.5) = 0.624655  â† ìˆ˜ë™ ê³„ì‚°ê³¼ ì™„ì „ ì¼ì¹˜
P(Q13=4 | LV=0.5) = 0.241730
P(Q13=5 | LV=0.5) = 0.066807
```

**ê²€ì¦**:
- âœ… ìˆ˜ë™ ê³„ì‚°ê³¼ ì°¨ì´: **0.0000000000**
- âœ… Apollo R ì½”ë“œì™€ ì™„ì „íˆ ë™ë“±

### TEST 4: SimultaneousEstimator í†µí•© âœ…

**ì‹œë®¬ë ˆì´ì…˜ ì„¤ì •**:
- ê°œì¸ ìˆ˜: 50
- Halton draws: 10
- ì§€í‘œ ìˆ˜: 3

**ê²°ê³¼**:
- ì´ ë¡œê·¸ìš°ë„: -189.80
- ê°œì¸ë‹¹ í‰ê·  ë¡œê·¸ìš°ë„: -3.80
- âœ… SimultaneousEstimator ë°©ì‹ í†µí•© ì„±ê³µ

---

## ğŸ’» ì‚¬ìš© ì˜ˆì‹œ

### 1. ê¸°ë³¸ ì‚¬ìš©ë²•

```python
from src.analysis.hybrid_choice_model.iclv_models import OrderedProbitMeasurement, MeasurementConfig

# ì„¤ì •
config = MeasurementConfig(
    indicators=['Q13', 'Q14', 'Q15'],
    n_categories=5
)

# ëª¨ë¸ ìƒì„±
model = OrderedProbitMeasurement(config)

# íŒŒë¼ë¯¸í„°
params = {
    'zeta': np.array([1.0, 1.2, 0.8]),
    'tau': np.array([
        [-2.0, -1.0, 1.0, 2.0],
        [-2.0, -1.0, 1.0, 2.0],
        [-2.0, -1.0, 1.0, 2.0]
    ])
}

# ë¡œê·¸ìš°ë„ ê³„ì‚°
ll = model.log_likelihood(data, latent_var, params)
```

### 2. SimultaneousEstimatorì™€ í†µí•©

```python
# SimultaneousEstimatorì—ì„œ ìë™ìœ¼ë¡œ í˜¸ì¶œ
estimator = SimultaneousEstimator(config)
results = estimator.estimate(
    data,
    measurement_model=model,  # OrderedProbitMeasurement
    structural_model=structural_model,
    choice_model=choice_model
)
```

---

## ğŸ” King (2022) ë…¼ë¬¸ê³¼ì˜ ë¹„êµ

| ì¸¡ë©´ | King (2022) Apollo R | í˜„ì¬ Python êµ¬í˜„ | ìƒíƒœ |
|------|---------------------|-----------------|------|
| **í™•ë¥  ê³„ì‚°** | `apollo_op()` | `_ordered_probit_probability()` | âœ… ë™ë“± |
| **ìš°ë„í•¨ìˆ˜** | `apollo_probabilities()` | `log_likelihood()` | âœ… ë™ë“± |
| **íŒŒë¼ë¯¸í„°** | `zeta`, `tau` | `params['zeta']`, `params['tau']` | âœ… ë™ë“± |
| **ì„ê³„ê°’ ìˆ˜** | 4ê°œ (5ì  ì²™ë„) | 4ê°œ (5ì  ì²™ë„) | âœ… ë™ë“± |
| **ìˆ˜ì¹˜ ì •í™•ë„** | R pnorm() | scipy.stats.norm.cdf() | âœ… ë™ë“± |

---

## ğŸ“Š ê¸°ì¡´ CFA vs Ordered Probit ë¹„êµ

| ì¸¡ë©´ | ê¸°ì¡´ CFA (ì—°ì†í˜•) | Ordered Probit (ìˆœì„œí˜•) |
|------|------------------|------------------------|
| **ë°ì´í„° ê°€ì •** | ì—°ì†í˜• ì •ê·œë¶„í¬ | ìˆœì„œí˜• ë²”ì£¼í˜• |
| **ìš°ë„í•¨ìˆ˜** | ì •ê·œë¶„í¬ | ëˆ„ì ì •ê·œë¶„í¬ ì°¨ì´ |
| **íŒŒë¼ë¯¸í„°** | ìš”ì¸ì ì¬ëŸ‰, ì˜¤ì°¨ë¶„ì‚° | ìš”ì¸ì ì¬ëŸ‰, ì„ê³„ê°’ |
| **ë¦¬ì»¤íŠ¸ ì²™ë„ ì í•©ì„±** | âŒ ë¶€ì í•© | âœ… ì í•© |
| **King (2022) ì‚¬ìš©** | âŒ ë¯¸ì‚¬ìš© | âœ… ì‚¬ìš© |
| **êµ¬í˜„ ìƒíƒœ** | âœ… semopy | âœ… ì™„ë£Œ |

---

## ğŸ¯ ë‹¤ìŒ ë‹¨ê³„

### âœ… ì™„ë£Œëœ ì‘ì—…
1. âœ… King (2022) R ì½”ë“œ ë¶„ì„
2. âœ… OrderedProbitMeasurement í´ë˜ìŠ¤ ì„¤ê³„
3. âœ… measurement_equations.py íŒŒì¼ ìƒì„±
4. âœ… í…ŒìŠ¤íŠ¸ ë° ê²€ì¦
5. âœ… Apollo R ì½”ë“œì™€ ë™ë“±ì„± í™•ì¸

### ğŸ”„ ì§„í–‰í•  ì‘ì—…
1. **êµ¬ì¡°ëª¨ë¸ (LatentVariableRegression)** êµ¬í˜„
   - ì‚¬íšŒì¸êµ¬í•™ì  ë³€ìˆ˜ â†’ ì ì¬ë³€ìˆ˜
   - êµ¬ì¡°ë°©ì •ì‹: LV = Î³*X + Î·
   
2. **ì„ íƒëª¨ë¸ (Mixed Logit)** ì™„ì„±
   - ì‹¤ì œ ì¶”ì • ë¡œì§ êµ¬í˜„
   - ì ì¬ë³€ìˆ˜ í†µí•©
   
3. **í•˜ì´ë¸Œë¦¬ë“œ ì—°ê²°ë¡œì§** ê²€ì¦
   - ì ì¬ë³€ìˆ˜ â†’ ì„ íƒ íš¨ìš©
   - Lambda íŒŒë¼ë¯¸í„° ì¶”ì •
   
4. **ë™ì‹œ ì¶”ì • (Simultaneous Estimation)** ì™„ì„±
   - ì „ì²´ ICLV íŒŒì´í”„ë¼ì¸ í†µí•©
   - ì‹¤ì œ ë°ì´í„° í…ŒìŠ¤íŠ¸

---

## ğŸ“ ê¸°ìˆ ì  ì„¸ë¶€ì‚¬í•­

### íŒŒë¼ë¯¸í„° êµ¬ì¡°

```python
params = {
    'zeta': np.ndarray,  # (n_indicators,) - ìš”ì¸ì ì¬ëŸ‰
    'tau': np.ndarray    # (n_indicators, n_thresholds) - ì„ê³„ê°’
}
```

### ë¡œê·¸ìš°ë„ ê³„ì‚° ì•Œê³ ë¦¬ì¦˜

```python
def log_likelihood(data, latent_var, params):
    total_ll = 0.0
    
    for each indicator:
        for each observation:
            # Ordered Probit í™•ë¥ 
            prob = Î¦(Ï„_k - Î¶*LV) - Î¦(Ï„_{k-1} - Î¶*LV)
            
            # ë¡œê·¸ìš°ë„ ëˆ„ì 
            total_ll += log(prob)
    
    return total_ll
```

### ìˆ˜ì¹˜ ì•ˆì •ì„±

- í™•ë¥  í´ë¦¬í•‘: `prob = np.clip(prob, 1e-10, 1 - 1e-10)`
- ë¡œê·¸ ë³€í™˜ ì „ ì–‘ìˆ˜ í™•ì¸
- ë§¤ìš° ì‘ì€ í™•ë¥  ì²˜ë¦¬: `-1e10`

---

## ğŸ† ê²°ë¡ 

**Ordered Probit ì¸¡ì •ëª¨ë¸ì´ King (2022) Apollo R ì½”ë“œì™€ ì™„ì „íˆ ë™ë“±í•˜ê²Œ êµ¬í˜„ë˜ì—ˆìŠµë‹ˆë‹¤.**

- âœ… ìˆ˜í•™ì  ì •í™•ì„± ê²€ì¦
- âœ… Apollo R ì½”ë“œì™€ ë™ë“±ì„± í™•ì¸
- âœ… SimultaneousEstimator í†µí•© ì„±ê³µ
- âœ… ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼

ì´ì œ ICLV ëª¨ë¸ì˜ í•µì‹¬ ì»´í¬ë„ŒíŠ¸ ì¤‘ **ì¸¡ì •ëª¨ë¸**ì´ ì™„ì„±ë˜ì—ˆìœ¼ë©°, 
ë‹¤ìŒ ë‹¨ê³„ë¡œ **êµ¬ì¡°ëª¨ë¸**, **ì„ íƒëª¨ë¸**, **ë™ì‹œ ì¶”ì •**ì„ ìˆœì°¨ì ìœ¼ë¡œ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

**ì‘ì„±ì¼**: 2025-11-04  
**ë²„ì „**: 1.0.0  
**ìƒíƒœ**: âœ… ì™„ë£Œ

