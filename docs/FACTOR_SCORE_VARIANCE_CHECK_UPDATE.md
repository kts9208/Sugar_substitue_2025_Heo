# ìš”ì¸ì ìˆ˜ ë¶„ì‚° ì²´í¬ ê¸°ëŠ¥ ì¶”ê°€

## ğŸ“‹ ê°œìš”

ìˆœì°¨ì¶”ì • ëª¨ë¸ì˜ 1ë‹¨ê³„ì—ì„œ ê³„ì‚°ëœ ìš”ì¸ì ìˆ˜ì˜ **ë¶„ì‚°(variance)**ì´ ë„ˆë¬´ ì‘ìœ¼ë©´ 2ë‹¨ê³„ ì„ íƒëª¨ë¸ì—ì„œ ë¹„ìœ ì˜í•˜ê²Œ ë‚˜ì˜¬ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤. ì´ë¥¼ ì‚¬ì „ì— ì§„ë‹¨í•˜ê¸° ìœ„í•´ ìš”ì¸ì ìˆ˜ ë¶„ì‚° ê³„ì‚° ë° íŒë‹¨ ë¡œì§ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.

## ğŸ”§ ìˆ˜ì • ë‚´ìš©

### 1. `_standardize_factor_scores` ë©”ì„œë“œ ê°œì„ 

**íŒŒì¼**: `src/analysis/hybrid_choice_model/iclv_models/sequential_estimator.py`

#### ë³€ê²½ ì‚¬í•­:
- âœ… **ë¶„ì‚°(variance) ê³„ì‚° ì¶”ê°€**: í‘œì¤€í¸ì°¨ë¿ë§Œ ì•„ë‹ˆë¼ ë¶„ì‚°ë„ í•¨ê»˜ ê³„ì‚°
- âœ… **ë¶„ì‚° ì„ê³„ê°’ ì²´í¬**: ë¶„ì‚°ì´ 0.01 ë¯¸ë§Œì¸ ê²½ìš° ê²½ê³  ë°œìƒ
- âœ… **ìƒì„¸ ë¡œê¹…**: í‘œì¤€í™” ì „í›„ì˜ í‰ê· , ë¶„ì‚°, í‘œì¤€í¸ì°¨ë¥¼ ëª¨ë‘ ì¶œë ¥
- âœ… **ê²½ê³  ë©”ì‹œì§€**: ë¶„ì‚°ì´ ë„ˆë¬´ ì‘ì€ ë³€ìˆ˜ì— ëŒ€í•œ ëª…í™•í•œ ê²½ê³  ë° ê¶Œì¥ì‚¬í•­ ì œê³µ

#### ì¶œë ¥ ì˜ˆì‹œ:
```
ìš”ì¸ì ìˆ˜ Z-score í‘œì¤€í™”:
ë³€ìˆ˜                              ì›ë³¸ í‰ê·       ì›ë³¸ ë¶„ì‚°      ì›ë³¸ std â†’   í‘œì¤€í™” í‰ê·    í‘œì¤€í™” ë¶„ì‚°   í‘œì¤€í™” std
------------------------------------------------------------------------------------------------------------------------
health_consciousness              5.2341      0.003456      0.0588 â†’     0.000000      1.000000      1.000000
perceived_benefit                 4.8923      0.892341      0.9446 â†’     0.000000      1.000000      1.000000
perceived_price                   3.5612      0.005123      0.0716 â†’     0.000000      1.000000      1.000000
purchase_intention                4.1234      1.234567      1.1111 â†’     0.000000      1.000000      1.000000
------------------------------------------------------------------------------------------------------------------------
âœ… ëª¨ë“  ìš”ì¸ì ìˆ˜ê°€ í‰ê·  0, í‘œì¤€í¸ì°¨ 1ë¡œ í‘œì¤€í™”ë¨

âš ï¸  ë¶„ì‚°ì´ ë„ˆë¬´ ì‘ì€ ìš”ì¸ì ìˆ˜ ë°œê²¬:
   (ì„ê³„ê°’: 0.01)
   - health_consciousness: ë¶„ì‚° = 0.003456
   - perceived_price: ë¶„ì‚° = 0.005123
   â†’ ì„ íƒëª¨ë¸ì—ì„œ ë¹„ìœ ì˜í•  ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.
   â†’ ì¸¡ì •ëª¨ë¸ ì¬ê²€í†  ë˜ëŠ” ì§€í‘œ ì¶”ê°€ë¥¼ ê³ ë ¤í•˜ì„¸ìš”.
```

### 2. `save_stage1_results` ë©”ì„œë“œ ê°œì„ 

**íŒŒì¼**: `src/analysis/hybrid_choice_model/iclv_models/sequential_estimator.py`

#### ë³€ê²½ ì‚¬í•­:
- âœ… **ë¶„ì‚° ì •ë³´ ì €ì¥**: `*_factor_scores_stats.csv` íŒŒì¼ì— ë¶„ì‚° ì»¬ëŸ¼ ì¶”ê°€
- âœ… **ê²½ê³  í”Œë˜ê·¸ ì¶”ê°€**: `low_variance_warning` ì»¬ëŸ¼ìœ¼ë¡œ ë¬¸ì œ ë³€ìˆ˜ í‘œì‹œ
- âœ… **ì €ì¥ ì‹œ ê²½ê³ **: ë¶„ì‚°ì´ ì‘ì€ ë³€ìˆ˜ê°€ ìˆì„ ê²½ìš° ë¡œê·¸ì— ê²½ê³  ì¶œë ¥

#### ì €ì¥ë˜ëŠ” CSV íŒŒì¼ êµ¬ì¡°:
```csv
latent_variable,mean,variance,std,min,max,n_observations,low_variance_warning
health_consciousness,5.2341,0.003456,0.0588,5.10,5.35,326,YES
perceived_benefit,4.8923,0.892341,0.9446,2.50,6.80,326,NO
perceived_price,3.5612,0.005123,0.0716,3.40,3.70,326,YES
purchase_intention,4.1234,1.234567,1.1111,1.20,6.90,326,NO
```

## ğŸ“Š ì €ì¥ë˜ëŠ” íŒŒì¼

1ë‹¨ê³„ ê²°ê³¼ ì €ì¥ ì‹œ ë‹¤ìŒ íŒŒì¼ë“¤ì´ ìƒì„±ë©ë‹ˆë‹¤:

```
results/sequential_stage_wise/
â”œâ”€â”€ stage1_HC-PB_HC-PP_PB-PI_PP-PI_results.pkl          # ì „ì²´ ê²°ê³¼ (pickle)
â”œâ”€â”€ stage1_HC-PB_HC-PP_PB-PI_PP-PI_results_paths.csv    # ê²½ë¡œê³„ìˆ˜
â”œâ”€â”€ stage1_HC-PB_HC-PP_PB-PI_PP-PI_results_loadings.csv # ìš”ì¸ì ì¬ëŸ‰
â”œâ”€â”€ stage1_HC-PB_HC-PP_PB-PI_PP-PI_results_fit_indices.csv # ì í•©ë„ ì§€ìˆ˜
â”œâ”€â”€ stage1_HC-PB_HC-PP_PB-PI_PP-PI_results_factor_scores_stats.csv  # â­ ìš”ì¸ì ìˆ˜ í†µê³„ (ë¶„ì‚° í¬í•¨)
â””â”€â”€ stage1_HC-PB_HC-PP_PB-PI_PP-PI_results_factor_scores.csv        # ìš”ì¸ì ìˆ˜ ì „ì²´ (326ëª…)
```

## ğŸ¯ ì‚¬ìš© ë°©ë²•

### ê¸°ì¡´ ì½”ë“œ ê·¸ëŒ€ë¡œ ì‚¬ìš© ê°€ëŠ¥

ìˆ˜ì • ì‚¬í•­ì€ **ìë™ìœ¼ë¡œ ì ìš©**ë˜ë¯€ë¡œ ê¸°ì¡´ ì½”ë“œë¥¼ ë³€ê²½í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤:

```python
from src.analysis.hybrid_choice_model.iclv_models import SequentialEstimator

# 1ë‹¨ê³„ ì¶”ì •
results = estimator.estimate_stage1_only(
    data=data,
    measurement_model=measurement_model,
    structural_model=structural_model
)

# ê²°ê³¼ ì €ì¥ (ë¶„ì‚° ì •ë³´ ìë™ í¬í•¨)
saved_path = SequentialEstimator.save_stage1_results(
    results, 
    'results/sequential_stage_wise/stage1_results.pkl'
)
```

### ë¶„ì‚° ì„ê³„ê°’ ì¡°ì • (ì„ íƒì‚¬í•­)

ê¸°ë³¸ ì„ê³„ê°’ì€ **0.01**ì´ì§€ë§Œ, í•„ìš”ì‹œ ì½”ë“œì—ì„œ ì¡°ì • ê°€ëŠ¥í•©ë‹ˆë‹¤:

```python
# sequential_estimator.py íŒŒì¼ì—ì„œ
variance_threshold = 0.01  # ì´ ê°’ì„ ì¡°ì •
```

## ğŸ“ˆ í•´ì„ ê°€ì´ë“œ

### ë¶„ì‚°ì´ ì‘ë‹¤ëŠ” ê²ƒì˜ ì˜ë¯¸

- **ë¶„ì‚° < 0.01**: 326ëª…ì˜ ì‘ë‹µì ê°„ ìš”ì¸ì ìˆ˜ ì°¨ì´ê°€ ê±°ì˜ ì—†ìŒ
- **ì›ì¸**: 
  - ì¸¡ì • ì§€í‘œë“¤ì´ ëª¨ë‘ ë¹„ìŠ·í•œ ê°’ìœ¼ë¡œ ì‘ë‹µë¨
  - ì—­ì½”ë”© ë¬¸ì œ
  - ì§€í‘œ ê°„ ìƒê´€ê´€ê³„ê°€ ë„ˆë¬´ ë†’ìŒ
  - ì‘ë‹µì ê°„ ì´ì§ˆì„±ì´ ë¶€ì¡±í•¨

### ëŒ€ì‘ ë°©ì•ˆ

1. **ì¸¡ì •ëª¨ë¸ ì¬ê²€í† **
   - ì§€í‘œë“¤ì´ ì œëŒ€ë¡œ ì¸¡ì •ë˜ê³  ìˆëŠ”ì§€ í™•ì¸
   - ì—­ì½”ë”© í•­ëª© í™•ì¸
   - ì§€í‘œ ê°„ ìƒê´€ê´€ê³„ ë¶„ì„

2. **ì§€í‘œ ì¶”ê°€/ë³€ê²½**
   - ë” ë‹¤ì–‘í•œ ì¸¡ì • ì§€í‘œ ì¶”ê°€
   - ë³€ë³„ë ¥ ìˆëŠ” ë¬¸í•­ìœ¼ë¡œ êµì²´

3. **ë°ì´í„° í™•ì¸**
   - ì‘ë‹µ íŒ¨í„´ ë¶„ì„
   - ì´ìƒì¹˜ í™•ì¸
   - ê²°ì¸¡ì¹˜ ì²˜ë¦¬ ë°©ë²• ì¬ê²€í† 

## âœ… í…ŒìŠ¤íŠ¸

ìˆ˜ì • í›„ ë‹¤ìŒê³¼ ê°™ì´ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```bash
# 1ë‹¨ê³„ ì¶”ì • ì‹¤í–‰
python examples/sequential_stage1_example.py

# ë¡œê·¸ í™•ì¸
cat logs/stage1_estimation.log | grep "ë¶„ì‚°"

# ì €ì¥ëœ í†µê³„ íŒŒì¼ í™•ì¸
cat results/sequential_stage_wise/*_factor_scores_stats.csv
```

## ğŸ“ ì°¸ê³ ì‚¬í•­

- ë¶„ì‚° ì²´í¬ëŠ” **í‘œì¤€í™” ì „** ì›ë³¸ ìš”ì¸ì ìˆ˜ì— ëŒ€í•´ ìˆ˜í–‰ë©ë‹ˆë‹¤
- í‘œì¤€í™” í›„ì—ëŠ” ëª¨ë“  ë³€ìˆ˜ì˜ ë¶„ì‚°ì´ 1.0ì´ ë©ë‹ˆë‹¤
- ê²½ê³ ëŠ” ë¡œê·¸ì™€ CSV íŒŒì¼ ëª¨ë‘ì— ê¸°ë¡ë©ë‹ˆë‹¤
- ì„ê³„ê°’(0.01)ì€ ê²½í—˜ì  ê¸°ì¤€ì´ë©°, ì—°êµ¬ ë§¥ë½ì— ë”°ë¼ ì¡°ì • ê°€ëŠ¥í•©ë‹ˆë‹¤

## ğŸ” ì½”ë“œ ìˆ˜ì • ìœ„ì¹˜

1. **Line 1152-1221**: `_standardize_factor_scores` ë©”ì„œë“œ
2. **Line 1343-1372**: `save_stage1_results` ë©”ì„œë“œì˜ í†µê³„ ì €ì¥ ë¶€ë¶„

